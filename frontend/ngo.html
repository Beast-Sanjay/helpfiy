<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <script>
    // var btn = document.createElement("button");
    // btn.onclick = fun()
    // btn.innerHTML = 'Create Button'
    async function updateInvestigating(id) {
      console.log('investigating')
      const res = await fetch('https://storageapi.fleek.co/1e4f9433-e9a2-4412-a561-9a1ddf54e93c-bucket/alldata.json')
      alldata = await res.json();
      alldata['issues'][id].status = 1
      alldata = JSON.stringify(alldata)
      // post to /updateStatus'
      fetch('https://hackoheist.el.r.appspot.com/updateStatus', {
        method: 'POST',
        headers: {
          "Content-Type": "text/plain;charset=UTF-8"
        },
        body: alldata,
        referrer: ""
      });


      document.getElementById("card" + id).style = "background-color: red"

      document.getElementById("footbtn1" + id).remove();


    }
    async function updateClose(id) {
      const res = await fetch('https://storageapi.fleek.co/1e4f9433-e9a2-4412-a561-9a1ddf54e93c-bucket/alldata.json')
      alldata = await res.json();
      alldata['issues'][id].status = 2;

      await fetch('https://hackoheist.el.r.appspot.com/updateStatus', {
        method: 'POST',
        body: JSON.stringify(alldata),
      });


      document.getElementById("card" + id).style = "background-color: green"
      document.getElementById("footbtn1" + id).remove();
      document.getElementById("footbtn2" + id).remove();
      var footbtnClosed = document.createElement("a");
      footbtnClosed.innerHTML = "Issue Closed"
      footbtnClosed.className = "card-footer-item";
      document.getElementById("card-footer" + id).appendChild(footbtnClosed);


    }

    async function fun() {
      const res = await fetch('https://storageapi.fleek.co/1e4f9433-e9a2-4412-a561-9a1ddf54e93c-bucket/alldata.json')
      alldata = await res.json();
      alldata = alldata['issues']
      for (var i = 0; i < alldata.length; i++) {
        if (alldata[i].status != 2) {
          var card = document.createElement("div");
          card.id = "card" + i;
          card.className = "card"
          var form = document.createElement("form");
          form.action = 'https://hackoheist.el.r.appspot.com/updateStatus'
          form.method = "POST";
          form.enctype = 'multipart/form-data';
          form.id = 'form' + i;
          var cardImage = document.createElement("div");
          cardImage.id = "cardImage" + i;
          cardImage.className = "card-image";
          var image = document.createElement("img");
          image.src = 'https://storageapi.fleek.co/1e4f9433-e9a2-4412-a561-9a1ddf54e93c-bucket/' + alldata[i].PicKey;
          var cardContent = document.createElement("div");
          cardContent.id = "cardContent" + i;
          cardContent.className = 'card-content';
          var mediaContent = document.createElement("div");
          mediaContent.id = 'mediaContent' + i;
          mediaContent.className = 'media-content'
          var content = document.createElement("div");
          content.id = 'content' + i;
          content.className = 'content';
          var myBr = document.createElement('br');
          var title = document.createElement('p');
          title.className = 'title is-4'
          title.innerHTML = alldata[i].location;
          var subtitle = document.createElement('p');
          subtitle.className = 'subtitle is-6'
          subtitle.innerHTML = alldata[i].userName + ", " + alldata[i].userEmail
          var subtitlebtn = document.createElement("input");
          subtitlebtn.value = i;
          subtitlebtn.name = "idbtn";
          subtitlebtn.type = 'button'
          var cardFooter = document.createElement("footer");
          cardFooter.id = "card-footer" + i;
          cardFooter.className = "card-footer";

          var footbtn1 = document.createElement("input");
          footbtn1.id = "footbtn1" + i;
          footbtn1.className = "card-footer-item  button";
          footbtn1.value = 'Investigating'
          // footbtn1.onclick = "updateInvestigating(" + i + ")"
          footbtn1.name = 'submitButton';
          footbtn1.type = 'submit'
          var footbtn2 = document.createElement("input");
          footbtn2.id = "footbtn2" + i;
          footbtn2.className = "card-footer-item button";
          footbtn2.value = 'Close'
          footbtn2.name = 'submitButton';
          footbtn2.type = 'submit'
          document.getElementById('container').appendChild(card);
          document.getElementById("card" + i).appendChild(form);
          document.getElementById('form' + i).appendChild(cardImage);
          document.getElementById("cardImage" + i).appendChild(image);
          document.getElementById('form' + i).appendChild(cardContent);
          document.getElementById("cardContent" + i).appendChild(mediaContent);
          document.getElementById('mediaContent' + i).appendChild(title);
          document.getElementById('mediaContent' + i).appendChild(subtitle);
          document.getElementById('mediaContent' + i).appendChild(subtitlebtn);

          document.getElementById("cardContent" + i).appendChild(myBr);
          document.getElementById("cardContent" + i).appendChild(content);
          document.getElementById('form' + i).appendChild(cardFooter);
          document.getElementById("card-footer" + i).appendChild(footbtn1);
          document.getElementById("card-footer" + i).appendChild(footbtn2);

          content.innerHTML = alldata[i].description
        }
      }
    }

  </script>
</head>

<body>



  <!--nav-->
  <nav class="navbar is-warning">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="#" style="font-weight:bold;">
          HELPIFY - NGO
        </a>
        <span class="navbar-burger burger" data-target="navMenu">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </div>

      <div id="navMenu" class="navbar-menu">
        <div class="navbar-end">
          <a href="index.html" class="navbar-item is-active">HOME</a>
          <a href="#" class="navbar-item">REGISTER</a>
          <a href="#complaint" class="navbar-item">DISPLAY</a>
          <a href="#donation" class="navbar-item">HELPLINE</a>
        </div>
      </div>
    </div>
  </nav>

  <button onclick="fun()"> Create Button </button>

  <div class="container columns is-3-desktop is-1-mobile" id="container"></div>


  <!-- <div class="card">
    <form action="https://hackoheist.el.r.appspot.com/updateStatus" method="POST" enctype="multipart/form-data">
      <div class="card-image">
        <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
      </div>

      <div class="card-content">

        <div class="media-content">
          <p class="title">John Smith</p>
          <p class="subtitle">@johnsmith</p>
        </div>
        <br>
        <div class="content">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
          Phasellus nec iaculis mauris. <a>@bulmaio</a>.
        </div>
      </div>
      <footer class="card-footer">
        <input id="investigate" type="submit" class="card-footer-item button" name="investigate" value="Investigate">
        <input id="close" type="submit" formaction="https://hackoheist.el.r.appspot.com/updateStatus2"
          class="card-footer-item button" name="close" value="Close">
      </footer>
    </form>
  </div> -->
  <script>


  </script>
</body>

</html>